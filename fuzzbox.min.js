/*!
 * fuzzbox.js
 *
 * Versatile media lightbox for jQuery
 *
 */
(function(y){try{var C=window,d=document,w=y(C),L=y(d),k=y.extend,F=y.each,e=function(M){if(!t.DEBUG){return}C.console.log("fuzzbox: "+M)},v=function(M){return M.charAt(0).toUpperCase()+M.substring(1)},o=function(R){var M=o;M.c=M.c||{};if(R in M.c){return M.c[R]}var O=d.documentElement.style;if(R in O){M.c[R]=R;return R}else{var Q="Webkit Moz O ms Khtml".split(" "),P=v(R),N=0,S;for(;N<Q.length;N++){S=Q[N]+P;if(S in O){M.c[R]=S;return S}}}M.c[R]=null;return null},H=function(S,P,O,Q,R,M){var M=M||function(){};if(h){S.each(function(){var V=this,T=y(this),U=function(){V.removeEventListener(K,U,false);V.style[h]="";M()};if(T.css(P)!=O){V.style[h]=["all",R,Q+"ms"].join(" ");V.addEventListener(K,U,false);V.style[P]=O}else{M()}})}else{var N={};N[P]=O;S.animate(N,Q,R,M)}},G=function(P,N,O,M){H(P,"opacity",N,O,"linear",M)},m=function(Q,N,P){var M=Q;if(N.indexOf("*")===-1){M.removeClass(N);return !P?M:M.addClass(P)}var O=new RegExp("\\s"+N.replace(/\*/g,"[A-Za-z0-9-_]+").split(" ").join("\\s|\\s")+"\\s","g");M.each(function(R,S){var T=" "+S.className+" ";while(O.test(T)){T=T.replace(O," ")}S.className=y.trim(T)});return !P?M:M.addClass(P)},c=function(N,M){return setTimeout(N,M||0)},x=function(M){return d.createElement(M)},b=function(){};C.console=C.console||{log:b,error:b};Object.keys=Object.keys||function(O){var N=[],M;for(M in O){if(O.hasOwnProperty(M)){N.push(M)}}return N};var t=y.fuzzbox=function(M){var M=this.options=k({vAlign:"middle",transitionFadeSpeed:100,theme:"default",template:"basic",text:J.text,cycle:false,clickOutside:false},M||{})};t.prototype={options:{},items:[],previousItem:null,activeItem:null,index:null,trigger:null,$template:null,open:function(S){var U=this;U.options=s=k(U.options,S||{});t.init();U.$template=t.template[s.template||"basic"];var T=n.$inner;T.append(U.$template);n.$content=T.find("#fzz-content");n.$caption=T.find("#fzz-caption");n.$previous=T.find("#fzz-previous");n.$next=T.find("#fzz-next");n.$closeBtn.html(s.text.close);n.$previous.html(s.text.previous);n.$next.html(s.text.next);var Q=s.items||[];U.isSingle=false;U.isGroup=true;var O="html" in s;if(O||s.url){var P={caption:s.caption,mediaArgs:s.mediaArgs,element:s.element,width:s.width,height:s.height};if(O){P.html=s.html}else{P.url=s.url}U.isSingle=true;U.isGroup=false;Q=[P]}Q=y.grep(Q,function(Z,V){var W=("html" in Z)||(Z.url&&Z.url!=location.href);if(!W){return false}var Y=Z.element,X=z(Y),aa;if("html" in Z){aa="html"}else{if(Z.media){aa=Z.media}else{if(X&&X.media){aa=X.media}else{if(!(aa=j(Z.url))){aa="html"}}}}Z.media=new r(aa);Z.attr=X||{};if(X){if(X.mediaArgs){Z.mediaArgs=k({},X.mediaArgs,Z.mediaArgs)}}return !!aa});if(!Q.length){e("No items to display");return false}F(Q,function(V,W){W.index=V;W.group=Q});U.items=Q;U.index=s.index||0;if(U.index>Q.length-1){U.index=Q.length-1}l=U.items[U.index];var N=["fzz-startup","fzz-itemcount-"+U.items.length,"fzz-theme-"+(s.theme||"default")].concat(E(l.media));n.$fuzzbox.attr("class",N.join(" "));var M="width" in s?s.width:"",R="height" in s?s.height:"";if(!M&&U.isSingle&&l.attr.width){M=l.attr.width}if(!R&&U.isSingle&&l.attr.height){R=l.attr.height}n.$wrapper.css({"max-width":M,"min-height":R});A(U);D=t.instance=this;t._open();q("open");U.trigger=d.activeElement;a=true;U.loadItem(l,function(){n.$fuzzbox.removeClass("fzz-startup");a=false});return true},loadItem:function(U,S){var V=this,M=n.$content[0],O=n.$caption[0];V.previousItem=f=V.activeItem;V.activeItem=l=U;V.prepareLoadMsg();var Q=null,P;if("errorMsg" in U){Q="error"}else{var W=U.media.toString(),N=U.media[0];if(t.media[W]){Q=W}else{if(t.media[N]){Q=N}else{Q="html"}}}var T=t.media[Q],R=function(aa,Y){V.clearContentAreas();m(n.$fuzzbox,"fzz-media-*",E(Y).join(" "));T.insert(aa,M,aa.mediaArgs||s.mediaArgs||{});var X=aa.caption||V.options.caption,Z=aa.element;if("function"===typeof X){X=X.call(Z||{},aa)}O.innerHTML=X||(Z&&Z.title)||"";q("insert");S&&S();t.positionHero();t.position()};if(!T.load){V.cancelLoadMsg();q("load");I(function(){R(U,Q)})}else{T.load(U,function(){V.cancelLoadMsg();q("load");if(U.errorMsg){Q="error";T=t.media[Q]}I(function(){R(U,Q)})})}},prepareLoadMsg:function(){var M=this;M.loadTimer=setTimeout(function(){M.showLoadMsg()},J.preloadDelay)},cancelLoadMsg:function(){var M=this;M.hideLoadMsg();clearTimeout(M.loadTimer)},showLoadMsg:function(){u=true;n.$loading.show();n.$fuzzbox.addClass("fzz-loading");q("showLoadMsg")},hideLoadMsg:function(){u=false;n.$loading.hide();n.$fuzzbox.removeClass("fzz-loading");q("hideLoadMsg")},disableElement:function(M){M.addClass("disabled").attr("tabindex",-1).blur()},enableElement:function(M){M.removeClass("disabled").removeAttr("tabindex")},goTo:function(P){var O=this,N=O.items,S=N.length-1,M=O.index;if(u||N.length<2){return}var R=s.cycle,Q;if("previous"==P){Q=(M>0)?M-1:0;if(R){Q=M===0?S:M-1}}else{if("next"==P){Q=(M<S)?M+1:S;if(R){Q=M===S?0:M+1}}else{if(P>0){P-=1;Q=P<=S?P:S}else{e("No destination");return}}}O.index=Q;A(O);O.loadItem(N[O.index])},next:function(){var M=this;if(!s.cycle&&M.index>=M.items.length-1){return}this.goTo("next")},previous:function(){var M=this;if(!s.cycle&&M.index<=0){return}M.goTo("previous")},close:function(){var M=this;t._close(function(){q("close");if(l.element){l.element.focus()}else{M.trigger&&M.trigger.focus()}M.cleanup()})},cleanup:function(){var M=this;M.clearContentAreas(true);M.enableElement(n.$previous);M.enableElement(n.$next);M.cancelLoadMsg();var N=n.$wrapper[0].style;N.top=N.left="";t.instance=D=null},clearContentAreas:function(N){var M=f&&!f.errorMsg&&"image"===f.media[0]&&"image"===l.media[0];if(!M){n.$content.empty()}n.$caption.empty();var O=t.getImage();O.src=O.style.marginTop="";n.$content.find(".fzz-hero").css("margin-top","");if(N){n.$inner.empty()}}};var D,l,f,a,s,u,h=o("transition"),p={transition:"transitionend",WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd"},K=h&&p[h],r=function(O){if(typeof O!=="string"){return O}var M=this,N=O.indexOf("/");M[0]=O;M[1]=null;if(N!==-1){M[0]=O.substring(0,N);M[1]=O.substring(N+1)}M.toString=function(){return M[0]+(M[1]?"/"+M[1]:"")}},j=function(P){var N=P.toLowerCase(),S=N.indexOf("#"),R=null;if(S!==-1){N=N.substring(0,S)}S=N.indexOf("?");if(S!==-1){N=N.substring(0,S)}var O,M=/\.([a-z0-9]+)$/.exec(N.replace(/\/+$/,"").toLowerCase());if(M){O=M[1]}else{return R}if(M=/^(jpe?g|png|gif|tiff?|webp)$/.exec(O)){R="image/"+M[1]}else{if(/^svgz?$/.test(O)){R="image/svg+xml"}else{if(/^(webm|ogv|ogg|ogv|mp4|m4v|3gp)?$/.test(O)){var Q="mp4";if(/^(ogv|ogg|ogm)$/.test(O)){Q="ogg"}else{if("webm"===O){Q="webm"}}R="video/"+Q}else{if(M=/^(mp3)?$/.exec(O)){R="audio/"+M[1]}else{if(/^html?$/.test(O)){R="html"}}}}}return R},z=function(N){if(!N){return null}var M={},O="data-fzz-";F(N.attributes,function(S,P){var R=P.name,V=R.indexOf(O);if(0===V){R=R.substring(O.length);var T=R.split("-"),U=T.shift();if(!M[U]&&!T.length){M[U]=P.value}else{if(T.length){var Q=U+"Args";M[Q]=M[Q]||{};M[Q][T[0]]=P.value}}}});return M},E=function(M){var N=[];N.push("fzz-media-"+M[0]);N.push("fzz-media-"+(M+"").replace(/\//,"-"));return N},q=function(M){var N="on"+v(M);L.trigger("fzz_"+M);D&&D[N]&&D[N].call(D)},I=function(P){var O="transitionFadeSpeed",N=O in s?s[O]:0,M=n.$content;if(N&&!a){u=true;G(M,0,N,function(){P();c(function(){G(M,1,N,function(){u=false})})})}else{P()}},A=function(M){var P=M.items.length,O=n.$previous,N=n.$next;if(P<2){M.disableElement(O);M.disableElement(N)}else{if(!s.cycle){M[(M.index>0?"enable":"disable")+"Element"](O);M[(M.index<P-1?"enable":"disable")+"Element"](N)}}};var g=function(N){if(!N){return null}var M=t.getVideo();return !!(M.canPlayType&&M.canPlayType(N).replace(/no/,""))},i={video:{mp4:'video/mp4; codecs="avc1.42E01E, mp4a.40.2"',webm:'video/webm; codecs="vp8, vorbis"',ogg:'video/ogg; codecs="theora, vorbis"'},audio:{}};k(t,{MediaType:r,guessMediaType:j,formats:i,testVideoFormat:g});var n=t.dom={};k(t,{DEBUG:false,opened:false,instance:null,init:function(){if(t.initialized){return}var M=y('<div id="fuzzbox"><div id="fzz-overlay"></div><div id="fzz-outer"><div id="fzz-wrapper" tabindex="0"><div id="fzz-inner"></div><div id="fzz-loading"></div><a id="fzz-close" href="fuzzbox:close"></a></div></div></div>');k(n,{$fuzzbox:M,$overlay:y("#fzz-overlay",M),$loading:y("#fzz-loading",M),$outer:y("#fzz-outer",M),$wrapper:y("#fzz-wrapper",M),$inner:y("#fzz-inner",M),$closeBtn:y("#fzz-close",M)});n.$loading.hide();var P=n.$wrapper;P.click(function(W){var V=W.target,R=y(V),X=null;var U="fuzzbox:",T;if(V.href&&V.href.indexOf(U)==0){X=V.href.substring(U.length);var S;if((S=X.indexOf("("))!==-1){T=X.substring(S).replace(/[\(\)]/g,"");X=X.substring(0,S)}}if(!X){return}if(R.hasClass("disabled")){return false}switch(X){case"close":t.close();break;case"previous":t.previous();break;case"next":t.next();break;case"goto":t.goTo(T||1);break}return false});var Q,N=function(X,ad){var U=X.pageX,S=X.pageY,ac=ad.width(),T=ad.offset(),R=T.left,Z=T.top,W=parseInt(ad.css("left"),10)||0,V=parseInt(ad.css("top"),10)||0,ab=U-R,aa=S-Z,Y=w.width();Q={el:{T:Z,R:R+ac,L:R,sX:W,sY:V,bT:-(Z-V),bL:-(R-W),bR:-(R-W)+(Y-ac)},m:{sX:U,sY:S,bT:aa,bR:Y-(ac-ab),bL:ab}};L.mousemove(O)},O=function(X){var W=X.pageX,V=X.pageY,Y=Q.m,T=Q.el,R=P[0],S=R.style,U,Z;if(V<Y.bT){Z=T.bT}else{Z=T.sY+(V-Y.sY)}if(W<Y.bL){U=T.bL}else{if(W>Y.bR){U=T.bR}else{U=T.sX+(W-Y.sX)}}S.top=Z+"px";S.left=U+"px"};P.mousedown(function(S){var R=y(S.target);if(R.hasClass("fzz-handle")){N(S,P);L.one("mouseup blur",function(){L.unbind("mousemove",O)});return false}});y([n.$overlay[0],n.$outer[0]]).click(function(R){if(R.target===this&&!s.clickOutside){t.close()}});L.keyup(function(S){var R=S.keyCode||S.which;if(R===27&&t.opened){t.close()}});L.keydown(function(S){var R=S.keyCode||S.which;if(t.opened){if(37===R){t.previous()}else{if(39===R){t.next()}}S.preventDefault()}});w.resize(t.position);P.bind("swipeleft",t.next);P.bind("swiperight",t.previous);n.$fuzzbox.hide();y("body").append(t.dom.$fuzzbox);q("init");t.initialized=true},_open:function(){var M=n.$fuzzbox;M.show();t.position();t.opened=true},_close:function(N){var M=n.$fuzzbox;G(M,0,J.fadeSpeed,function(){M.hide().css("opacity","");N&&N()});t.opened=false},open:function(M){return !(new t(M).open())},close:function(){D&&D.close()},previous:function(){D&&D.previous()},next:function(){D&&D.next()},goTo:function(M){D&&D.goTo(M)},position:function(){var N=n.$outer[0],O=N.offsetHeight,M=w.height(),Q=w.scrollTop(),P=0,R=s.vAlign;if("middle"===R){if(M>O){P=(M-O)/2}}else{if("top"===R){}else{if(+R){P=R}}}P+=Q;N.style.top=P+"px"},positionHero:function(){var M=n.$content.find(".fzz-hero");if(M.length){var N=M[0],O=n.$content[0].offsetHeight-N.offsetHeight;if(O>0){N.style.marginTop=(O/2)+"px"}}},loadUrl:function(M,N,O){y.ajax({url:M,success:function(P){N.html=P;O(N)},error:function(Q,P){N.errorMsg=P;O(N)}})},loadImage:function(N,O,P){var M=new Image;M.onload=function(){O.image=M;P(O)};M.onabort=M.onerror=function(Q){Q=Q||window.event;O.errorMsg=Q.type+' loading image: "'+N+'"';P(O)};M.src=N},getIframe:function(){var M=n.iframe;if(!M){M=n.iframe=x("iframe");y(M).attr({"class":"fzz-hero",frameborder:0,width:"100%",height:"100%"})}return M},getVideo:function(){var M=n.video;if(!M){M=n.video=x("video");M.className="fzz-hero"}return M},getAudio:function(){var M=n.audio;if(!M){M=n.audio=x("audio");M.className="fzz-hero"}return M},getImage:function(){var M=n.image;if(!M){M=n.image=x("img");M.className="fzz-hero"}return M},template:{basic:y('<div class="fzz-handle"></div><div id="fzz-content"></div><div id="fzz-caption"></div><a id="fzz-previous" href="fuzzbox:previous"></a><a id="fzz-next" href="fuzzbox:next"></a>')},media:{error:{insert:function(O,M,N){M.innerHTML="<p>"+O.errorMsg+"</p>"}},html:{load:function(O,M,N){if(O.url){t.loadUrl(O.url,O,function(P){M(P.errorMsg)})}else{M()}},insert:function(P,M,O){if(O.target){var N=x("div");N.innerHTML=P.html;P.html=y(N).find(O.target).html()}M.innerHTML=P.html}},image:{load:function(O,M,N){t.loadImage(O.url,O,function(P){M(P.errorMsg)})},insert:function(O,M,N){var P=t.getImage();if(!P.parentNode){M.appendChild(P)}P.src=O.image.src}},iframe:{insert:function(Q,M,N){var O=t.getIframe(),P={src:Q.url||N.url,width:("width" in N)?N.width:"100%",height:("height" in N)?N.height:"100%"};delete N.url;delete N.src;y.extend(P,N);y(O).attr(P);M.appendChild(O)}},video:{insert:function(V,P,Q){var O=t.getVideo(),U={width:("width" in Q)?Q.width:"100%",height:("height" in Q)?Q.height:"100%",poster:Q.poster||null,autoplay:"autoplay" in Q?true:null,controls:"controls" in Q?true:null,loop:"loop" in Q?true:null,muted:"muted" in Q?true:null},N=y(O);N.attr(U);var S=V.media[1],R=t.formats.video,T=S&&R[S],M;if(g(T)){M=y("<source/>").attr({type:T,src:V.url})[0]}else{F(Object.keys(Q).sort(),function(W,X){if(X.indexOf("fallback")===0){var Y=j(Q[X])}})}if(M){O.appendChild(M)}P.appendChild(O)}},"video/youtube":{insert:function(P,M,N){var O=t.getIframe();y(O).attr({src:"http://www.youtube.com/embed/"+N.ytid,width:("width" in N)?N.width:"100%",height:("height" in N)?N.height:"100%"});M.appendChild(O)}}}});var J=t.settings={};k(J,{text:{close:"Close",next:"Next",previous:"Previous"},preloadDelay:80,fadeSpeed:120,});y.fn.fuzzbox=function(O){var Q=this,O=O||{},P="html" in O,N=O.url,R=(true===O.group)&&!(P||N),M=[];if(R){Q.each(function(){var S={};S.url=this.href;S.element=this;M.push(S)})}Q.click(function(){var U=new y.fuzzbox,V=0,T=this,S=k({},O);S.element=this;if(P||N){}else{if(R){F(M,function(W,X){if(T===X.element){V=W}});S.index=V}else{if(O.items){M=O.items}else{M=[{url:this.href,element:this}]}}}if(M.length){S.items=M}return !U.open(S)});return Q}}catch(B){console.error('fuzzbox "'+B+'"')}})(jQuery);