/*!

Flexible media lightbox for jQuery

Project: https://github.com/peteboere/fuzzbox
License: http://www.opensource.org/licenses/mit-license.php (MIT)
Copyright: (c) 2012 Pete Boere
Compiled: 2012-12-18 11:12:08 +0000

*/(function(e){var t=window,n=document,r=e(t),i=e(n),s=e.extend,o=e.each,u=function(e){g.DEBUG&&t.console.log("fuzzbox: "+e)},a=function(e){return typeof e!="undefined"},f=function(e){return e.charAt(0).toUpperCase()+e.substring(1)},l=function(t,n,r,i,s,o){var u=e.fn.transition?"transition":"animate",a={};a[n]=r,t[u](a,i,s,o)},c=function(e,t,n,r){l(e,"opacity",t,n,"linear",r)},h=function(t,n,r){var i=t;if(n.indexOf("*")===-1)return i.removeClass(n),r?i.addClass(r):i;var s=new RegExp("\\s"+n.replace(/\*/g,"[A-Za-z0-9-_]+").split(" ").join("\\s|\\s")+"\\s","g");return i.each(function(t,n){var r=" "+n.className+" ";while(s.test(r))r=r.replace(s," ");n.className=e.trim(r)}),r?i.addClass(r):i},p=function(e,t){return setTimeout(e,t||0)},d=function(e){return n.createElement(e)},v=function(){},m=!!t.ActiveXObject&&+/msie\s(\d+)/i.exec(navigator.userAgent)[1]||NaN;t.console=t.console||{log:v,error:v},Object.keys=Object.keys||function(e){var t=[],n;for(n in e)e.hasOwnProperty(n)&&t.push(n);return t};var g=e.fuzzbox=function(e){var e=this.options=s({vAlign:"middle",transitionFadeSpeed:100,theme:"default",template:"basic",text:P.text,cycle:!1,exactFit:!1,closeOnClickOutside:!0,closeOnPressEscape:!0},e||{})};g.prototype={options:{},items:[],previousItem:null,activeItem:null,index:null,dims:null,trigger:null,$template:null,open:function(t){var r=this;r.options=S=s(r.options,t||{}),e.each(S,function(e,t){/^on[A-Z]/.test(e)&&(r[e]=t)}),g.init(),r.$template=g.template[S.template||"basic"];var i=D.$inner;i.append(r.$template),D.$content=i.find("#fzz-content"),D.$caption=i.find("#fzz-caption"),D.$previous=i.find("#fzz-previous"),D.$next=i.find("#fzz-next"),D.$closeBtn.find(">span").html(S.text.close),D.$previous.find(">span").html(S.text.previous),D.$next.find(">span").html(S.text.next);var f=S.items||[],l="html"in S;if(l||S.url){var c={caption:S.caption,mediaArgs:S.mediaArgs,element:S.element,width:S.width,height:S.height};l?c.html=S.html:c.url=S.url,f=[c]}f=e.grep(f,function(e,t){var n="html"in e||e.url;if(!n)return!1;var r=e.element,i=C(r),o;return"html"in e?o="html":e.media?o=e.media:i&&i.media?o=i.media:S.media?o=S.media:(o=N(e.url))||(o="html"),e.media=new T(o),e.attr=i||{},"html"===e.media[0]&&!a(e.html)&&e.attr.html&&(e.html=unescape(e.attr.html)),i&&i.mediaArgs&&(e.mediaArgs=s({},i.mediaArgs,e.mediaArgs)),!!o});var p=f.length,d=p===1;if(!p)return u("No items to display"),!1;o(f,function(e,t){t.index=e,t.group=f}),r.items=f,r.index=S.index||0,r.index>p-1&&(r.index=p-1),b=r.items[r.index],y=g.instance=this;var v=d&&b.attr.theme||S.theme||"default",m=["fzz-startup","fzz-itemcount-"+r.items.length,"fzz-theme-"+e.trim(v).split(" ").join(" fzz-theme-")];D.$fuzzbox.attr("class",m.join(" "));var w="width"in S?S.width:"",x="height"in S?S.height:"",d=p===1,k=b.attr.width,A=b.attr.height,M=/[^0-9\.]/;return!w&&d&&k&&(w=M.test(k)?k:+k),!x&&d&&b.attr.height&&(x=M.test(A)?A:+A),r.dims={width:w,height:x},g.setDims(),O(),g._open(),L("open"),r.trigger=n.activeElement,D.$wrapper.focus(),E=!0,r.loadItem(b,function(){h(D.$fuzzbox,"fzz-startup","fzz-open"),E=!1}),!0},loadItem:function(e,t){var n=this,r=D.$content[0];n.previousItem=w=n.activeItem,n.activeItem=b=e,n.prepareLoadMsg();var i=null,s;if("errorMsg"in e)i="error";else{var o=e.media.toString(),u=e.media[0];g.media[o]?i=o:g.media[u]?i=u:i="html"}var a=g.media[i],f=function(e,i){n.clearContentAreas(),h(D.$fuzzbox,"fzz-media-*",k(e.media).join(" ")),a.insert(e,r,e.mediaArgs||S.mediaArgs||{});var s=e.caption||n.options.caption,o=e.element;typeof s=="function"?s=s.call(o||{},e):s=s||o&&o.title,s&&D.$caption.append(s),L("insert"),t&&t(),g.positionHero(e),g.position()};a.load?a.load(e,function(){n.cancelLoadMsg(),L("load"),e.errorMsg&&(i="error",a=g.media[i],e.media.update(i)),A(function(){f(e,i)})}):(n.cancelLoadMsg(),L("load"),A(function(){f(e,i)}))},prepareLoadMsg:function(){var e=this;e.loadTimer=setTimeout(function(){e.showLoadMsg()},P.preloadDelay)},cancelLoadMsg:function(){var e=this;e.hideLoadMsg(),clearTimeout(e.loadTimer)},showLoadMsg:function(){x=!0,D.$loading.show(),D.$fuzzbox.addClass("fzz-loading"),L("showLoadMsg")},hideLoadMsg:function(){x=!1,D.$loading.hide(),D.$fuzzbox.removeClass("fzz-loading"),L("hideLoadMsg")},disableElement:function(e){e.addClass("disabled").attr("tabindex",-1).blur()},enableElement:function(e){e.removeClass("disabled").removeAttr("tabindex")},goTo:function(e){var t=this,n=t.items,r=n.length-1,i=t.index;if(x||n.length<2)return;var s=S.cycle,o;if("previous"==e)o=i>0?i-1:0,s&&(o=i===0?r:i-1);else if("next"==e)o=i<r?i+1:r,s&&(o=i===r?0:i+1);else{if(!(e>0)){u("No destination");return}e-=1,o=e<=r?e:r}t.index=o,O(t),t.loadItem(n[t.index])},next:function(){var e=this;if(!S.cycle&&e.index>=e.items.length-1)return;this.goTo("next")},previous:function(){var e=this;if(!S.cycle&&e.index<=0)return;e.goTo("previous")},close:function(){var e=this;g._close(function(){L("close"),b.element?b.element.focus():e.trigger&&e.trigger.focus(),e.cleanup()})},cleanup:function(){var e=this;e.clearContentAreas(!0),e.enableElement(D.$previous),e.enableElement(D.$next),e.cancelLoadMsg(),D.$fuzzbox.removeClass("fzz-open");var t=D.$wrapper[0].style;t.top=t.left="",g.instance=y=null},clearContentAreas:function(e){var t=w&&!w.errorMsg&&"image"===w.media[0]&&"image"===b.media[0];t||D.$content.empty(),D.$caption.empty(),g.resetImage(),g.resetIframe(),D.$content.find(".fzz-hero").css("margin-top",""),e&&(D.$inner.empty(),D.$outer.css("top",""),g.resetImage(!0))}};var y,b,w,E,S,x,T=function(e){var t=this;return t.update=function(e){if(typeof e!="string")return e;var n=e.indexOf("/");t[0]=e,t[1]=null,n!==-1&&(t[0]=e.substring(0,n),t[1]=e.substring(n+1))},t.toString=function(){return t[0]+(t[1]?"/"+t[1]:"")},t.update(e)},N=function(e){var t=e.toLowerCase(),n=t.indexOf("#"),r=null;n!==-1&&(t=t.substring(0,n)),n=t.indexOf("?"),n!==-1&&(t=t.substring(0,n));var i,s=/\.([a-z0-9]+)$/.exec(t.replace(/\/+$/,"").toLowerCase());if(!s)return r;i=s[1];if(s=/^(jpe?g|png|gif|tiff?|webp)$/.exec(i))r="image/"+s[1];else if(/^svgz?$/.test(i))r="image/svg";else if(/^(webm|ogv|ogg|ogv|mp4|m4v|3gp)?$/.test(i)){var o="mp4";/^(ogv|ogg|ogm)$/.test(i)?o="ogg":"webm"===i&&(o="webm"),r="video/"+o}else(s=/^(mp3)?$/.exec(i))?r="audio/"+s[1]:/^html?$/.test(i)&&(r="html");return r},C=function(e){if(!e)return null;var t={},n="data-fzz-";return o(e.attributes,function(e,r){var i=r.name,s=i.indexOf(n);if(0===s){i=i.substring(n.length);var o=i.split("-"),u=o.shift();if(!t[u]&&!o.length)t[u]=r.value;else if(o.length){var a=u+"Args";t[a]=t[a]||{},t[a][o[0]]=r.value}}}),t},k=function(e){var t=[];return t.push("fzz-media-"+e[0]),t.push("fzz-media-"+(e+"").replace(/\//,"-")),t},L=function(e){var t="on"+f(e);i.trigger("fzz_"+e),y&&y[t]&&y[t].call(y)},A=function(e){var t="transitionFadeSpeed",n=t in S?S[t]:0,r=D.$content;n&&!E?(x=!0,c(r,0,n,function(){e(),p(function(){c(r,1,n,function(){x=!1})},13)})):e()},O=function(){var e=y.items.length,t=D.$previous,n=D.$next;e<2?(y.disableElement(t),y.disableElement(n)):S.cycle||(y[(y.index>0?"enable":"disable")+"Element"](t),y[(y.index<e-1?"enable":"disable")+"Element"](n))},M=function(e){if(!e)return null;var t=g.getVideo();return!!t.canPlayType&&!!t.canPlayType(e).replace(/no/,"")},_={video:{mp4:'video/mp4; codecs="avc1.42E01E, mp4a.40.2"',webm:'video/webm; codecs="vp8, vorbis"',ogg:'video/ogg; codecs="theora, vorbis"'},audio:{}};s(g,{Media:T,guessMediaType:N,formats:_,testVideoFormat:M});var D=g.dom={};s(g,{DEBUG:!1,opened:!1,instance:null,init:function(){if(g.initialized)return;var t=e('<div id="fuzzbox"><div id="fzz-overlay"></div><div id="fzz-outer"><div id="fzz-wrapper" tabindex="0"><div id="fzz-inner"></div><div id="fzz-loading"></div><a id="fzz-close" href="modal:close"><span></span></a></div></div></div>');s(D,{$fuzzbox:t,$overlay:e("#fzz-overlay",t),$loading:e("#fzz-loading",t),$outer:e("#fzz-outer",t),$wrapper:e("#fzz-wrapper",t),$inner:e("#fzz-inner",t),$closeBtn:e("#fzz-close",t)}),D.$loading.hide();var n=D.$wrapper;n.click(function(t){var n=e(t.target).closest("a"),r=n[0],i=null,s="modal:",o;if(r&&r.href&&r.href.indexOf(s)==0){i=r.href.substring(s.length);var u;(u=i.indexOf("("))!==-1?(o=i.substring(u).replace(/[\(\)]/g,""),i=i.substring(0,u)):/^\d$/.test(i)&&(o=i,i="goto")}if(!i)return;if(n.hasClass("disabled"))return!1;switch(i){case"close":g.close();break;case"previous":g.previous();break;case"next":g.next();break;case"goto":g.goTo(o||1)}return!1});var o,u=function(e,t){var n=e.pageX,s=e.pageY,u=t.width(),f=t.offset(),l=f.left,c=f.top,h=parseInt(t.css("left"),10)||0,p=parseInt(t.css("top"),10)||0,d=n-l,v=s-c,m=r.width();o={el:{T:c,R:l+u,L:l,sX:h,sY:p,bT:-(c-p),bL:-(l-h),bR:-(l-h)+(m-u)},m:{sX:n,sY:s,bT:v,bR:m-(u-d),bL:d}},i.mousemove(a)},a=function(e){var t=e.pageX,r=e.pageY,i=o.m,s=o.el,u=n[0],a=u.style,f,l;r<i.bT?l=s.bT:l=s.sY+(r-i.sY),t<i.bL?f=s.bL:t>i.bR?f=s.bR:f=s.sX+(t-i.sX),a.top=l+"px",a.left=f+"px"};n.mousedown(function(t){var r=e(t.target);if(r.hasClass("fzz-handle"))return u(t,n),i.one("mouseup blur",function(){i.unbind("mousemove",a)}),!1}),e([D.$overlay[0],D.$outer[0]]).click(function(e){e.target===this&&S.closeOnClickOutside&&g.close()}),i.keyup(function(e){var t=e.keyCode||e.which;t===27&&g.opened&&S.closeOnPressEscape&&g.close()}),i.keydown(function(e){var t=e.keyCode||e.which;g.opened&&(37===t?(g.previous(),e.preventDefault()):39===t&&(g.next(),e.preventDefault()))}),r.resize(function(){g.position(),g.positionHero(),g.setHeight()}),D.$fuzzbox.hide(),e("body").append(g.dom.$fuzzbox),L("init"),g.initialized=!0},_open:function(){var e=D.$fuzzbox;e.show(),g.position(),g.opened=!0},_close:function(e){var t=D.$fuzzbox;c(t,0,P.fadeSpeed,function(){t.hide().css("opacity",""),e&&e()}),g.opened=!1},open:function(e){return!(new g(e)).open()},close:function(){y&&y.close()},previous:function(){y&&y.previous()},next:function(){y&&y.next()},goTo:function(e){y&&y.goTo(e)},position:function(){var e=D.$outer[0],t=e.offsetHeight,n=r.height(),i=r.scrollTop(),s=0,o=S.vAlign;"middle"===o?n>t&&(s=(n-t)/2):"top"!==o&&+o&&(s=o),s+=i,e.style.top=s+"px"},positionHero:function(e){var t=D.$content.find(".fzz-hero");if(!S.exactFit&&t.length){var n=t[0],r=D.$content[0].offsetHeight,i=n.offsetHeight;e&&e.image&&(i=e.image.height),diff=r-i,diff>0&&(n.style.marginTop=diff/2+"px")}},loadUrl:function(t,n,r){e.ajax({url:t,success:function(e){n.html=e,r(n)},error:function(e,t){n.errorMsg=t,r(n)}})},loadImage:function(e,t,n){var r=new Image;r.onload=function(){t.image=r,n(t)},r.onabort=r.onerror=function(r){r=r||window.event,t.errorMsg=r.type+' loading image: "'+e+'"',n(t)},r.src=e},getIframe:function(t){var n=D.iframe;return n||(n=D.iframe=d("iframe")),e(n).attr({"class":"fzz-hero",frameborder:0,width:"100%",height:"100%"}),n},resetIframe:function(){var e=D.iframe;e&&(e.src="data:text/html,0")},getVideo:function(){var e=D.video;return e||(e=D.video=d("video"),e.className="fzz-hero"),e},getAudio:function(){var e=D.audio;return e||(e=D.audio=d("audio"),e.className="fzz-hero"),e},getImage:function(){var e=D.image;return e||(e=D.image=d("img"),e.className="fzz-hero"),e},resetImage:function(e){var t=D.image;t&&(e?(delete D.image,D.image=g.getImage()):t.style.marginTop="")},setDims:function(){g.setWidth(),g.setHeight()},setWidth:function(e){widthMap={"max-width":y.dims.width||e||""};if(widthMap["max-width"]&&/\d+(px)?$/.test(widthMap["max-width"]+"")){var t=D.$inner,n=t.outerWidth(!0)-t.width();widthMap["max-width"]=parseInt(widthMap["max-width"],10)+n}D.$wrapper.css(widthMap)},setHeight:function(e){var t={height:y.dims.height||e||""};D.$content.css(t)},markdown:function(t){return e.trim((" "+t+" ").replace(/([^_\w])_([^_]+)_([^_\w])/g,function(e,t,n,r){return t+"<i>"+n+"</i>"+r}).replace(/([^\*\w])\*([^\*]+)\*([^\*\w])/g,function(e,t,n,r){return t+"<b>"+n+"</b>"+r}))},template:{basic:e('<div id="fzz-handle" class="fzz-handle"></div><div id="fzz-content"></div><div id="fzz-caption"></div><a id="fzz-previous" href="modal:previous"><span></span></a><a id="fzz-next" href="modal:next"><span></span></a>')},media:{error:{insert:function(e,t,n){t.innerHTML='<p class="fzz-hero">'+e.errorMsg+"</p>"}},html:{load:function(e,t,n){!a(e.html)&&e.url?g.loadUrl(e.url,e,function(e){t(e.errorMsg)}):t()},insert:function(t,n,r){if(r.target){var i=d("div");i.innerHTML=t.html,t.html=e(i).find(r.target).html()}e(n).append(t.html)}},image:{load:function(e,t,n){g.loadImage(e.url,e,function(e){t(e.errorMsg)})},insert:function(e,t,n){var r=g.getImage();r.parentNode||t.appendChild(r),r.width=e.image.width,r.height=e.image.height,r.src=e.image.src,g.setHeight(e.image.height),S.exactFit&&g.setWidth(e.image.width)}},iframe:{insert:function(t,n,r){var i=g.getIframe(),s="width"in r?r.width:"100%",o="height"in r?r.height:"100%",u={src:t.url||r.url,width:s,height:o};delete r.url,delete r.src,e.extend(u,r),e(i).attr(u),n.appendChild(i)}},"video/youtube":{insert:function(t,n,r){var i=g.getIframe(),s="width"in r?r.width:"100%",o="height"in r?r.height:"100%";e(i).attr({src:"http://www.youtube.com/embed/"+r.ytid,width:s,height:o}),n.appendChild(i)}}}});var P=g.settings={};s(P,{text:{close:"Close",next:"Next",previous:"Previous"},preloadDelay:80,fadeSpeed:150}),e.fn.fuzzbox=function(t){var n=this,t=t||{},r="html"in t,i=t.url,u=!0===t.group&&!r&&!i,a=[];return u&&n.each(function(){var e={};e.url=this.href,e.element=this,a.push(e)}),n.click(function(){var n=new e.fuzzbox,f=0,l=this,c=s({},t);return c.element=this,!r&&!i&&(u?(o(a,function(e,t){l===t.element&&(f=e)}),c.index=f):t.items?a=t.items:a=[{url:this.getAttribute("href")?this.href:null,element:this}]),a.length&&(c.items=a),!n.open(c)}),n}})(jQuery);