/*!

Flexible media lightbox for jQuery

Project: https://github.com/peteboere/fuzzbox
License: http://www.opensource.org/licenses/mit-license.php (MIT)
Copyright: (c) 2012 Pete Boere
Compiled: 2013-07-02 14:03:14 +0100

*/(function(e){var t=window,n=document,r=e(t),i=e(n),s=e.extend,o=e.each,u=function(e){g.DEBUG&&t.console.log("fuzzbox: "+e)},a=function(e){return typeof e!="undefined"},f=function(e){return e.charAt(0).toUpperCase()+e.substring(1)},l=function(t,n,r,i,s,o){var u=e.fn.transition?"transition":"animate",a={};a[n]=r,t[u](a,i,s,o)},c=function(e,t,n,r){l(e,"opacity",t,n,"linear",r)},h=function(t,n,r){var i=t;if(n.indexOf("*")===-1)return i.removeClass(n),r?i.addClass(r):i;var s=new RegExp("\\s"+n.replace(/\*/g,"[A-Za-z0-9-_]+").split(" ").join("\\s|\\s")+"\\s","g");return i.each(function(t,n){var r=" "+n.className+" ";while(s.test(r))r=r.replace(s," ");n.className=e.trim(r)}),r?i.addClass(r):i},p=function(e,t){return setTimeout(e,t||0)},d=function(e){return n.createElement(e)},v=function(){},m=!!t.ActiveXObject&&+/msie\s(\d+)/i.exec(navigator.userAgent)[1]||NaN;t.console=t.console||{log:v,error:v},Object.keys=Object.keys||function(e){var t=[],n;for(n in e)e.hasOwnProperty(n)&&t.push(n);return t};var g=e.fuzzbox=function(e){this.options=s({vAlign:"middle",transitionFadeSpeed:100,theme:"default",template:"basic",text:P.text,cycle:!1,exactFit:!1,closeOnClickOutside:!0,closeOnPressEscape:!0,fittingBreakpoint:0},e||{})};g.prototype={options:{},items:[],previousItem:null,activeItem:null,index:null,dims:null,trigger:null,$template:null,open:function(t){var r=this;r.options=S=s(r.options,t||{}),e.each(S,function(e,t){/^on[A-Z]/.test(e)&&(r[e]=t)}),g.init(),r.$template=g.template[S.template||"basic"];var i=N.$inner;return i.append(r.$template),N.$content=i.find("#fzz-content"),N.$caption=i.find("#fzz-caption"),N.$previous=i.find("#fzz-previous"),N.$next=i.find("#fzz-next"),N.$closeBtn.find(">span").html(S.text.close),N.$previous.find(">span").html(S.text.previous),N.$next.find(">span").html(S.text.next),y=g.instance=this,r.items=r.prepareItems(S.items||[]),r.items?(r.prepareStage(!0),g._open(),r.trigger=n.activeElement,N.$wrapper.focus(),E=!0,x=e(window).scrollTop(),r.loadItem(b,function(){p(function(){h(N.$fuzzbox,"fzz-startup","fzz-open"),O("open"),E=!1},50)}),!0):!1},prepareItems:function(t){var n=this,r="html"in S;if(r||S.url){var i={caption:S.caption,mediaArgs:S.mediaArgs,element:S.element,width:S.width,height:S.height};r?i.html=S.html:(i.url=S.url,i.data=S.data,i.postData=S.postData),t=[i]}t=e.grep(t,function(e,t){var n="html"in e||e.url;if(!n)return!1;var r=e.element,i=L(r),o;return"html"in e?o="html":e.media?o=e.media:i&&i.media?o=i.media:S.media?o=S.media:(o=k(e.url))||(o="html"),e.media=new C(o),e.attr=i||{},"html"===e.media[0]&&!a(e.html)&&e.attr.html&&(e.html=unescape(e.attr.html)),i&&i.mediaArgs&&(e.mediaArgs=s({},i.mediaArgs,e.mediaArgs)),!!o}),o(t,function(e,n){n.index=e,n.group=t});var f=t.length,l=f===1;return f?t:(u("No items to display"),!1)},prepareStage:function(t){var n=this;n.index=S.index||0;var r=n.items.length;n.index>r-1&&(n.index=r-1),b=n.items[n.index];var i=r===1,s=i&&b.attr.theme||S.theme||"default",o=["fzz-itemcount-"+n.items.length,"fzz-theme-"+e.trim(s).split(" ").join(" fzz-theme-")];t&&o.push("fzz-startup"),N.$fuzzbox.attr("class",o.join(" "));var u="width"in S?S.width:"",a="height"in S?S.height:"",f=b.attr.width,l=b.attr.height,c=/[^0-9\.]/;!u&&i&&f&&(u=c.test(f)?f:+f),!a&&i&&b.attr.height&&(a=c.test(l)?l:+l),n.dims={width:u,height:a},g.setDims(),n.setNextPreviousBtns()},setNextPreviousBtns:function(){var e=this,t=e.items.length,n=N.$previous,r=N.$next;t<2?(e.disableLink(n),e.disableLink(r)):S.cycle||(e[(e.index>0?"enable":"disable")+"Link"](n),e[(e.index<t-1?"enable":"disable")+"Link"](r))},loadItem:function(e,t){var n=this,r=N.$content[0];n.previousItem=w=n.activeItem,n.activeItem=b=e,n.prepareLoadMsg();var i=null;if("errorMsg"in e)i="error";else{var s=e.media.toString(),o=e.media[0];g.media[s]?i=s:g.media[o]?i=o:i="html"}var u=g.media[i],a=function(e,i){n.clearContentAreas(),h(N.$fuzzbox,"fzz-media-*",A(e.media).join(" ")),O("beforeInsert",{item:e});var s=e.mediaArgs||S.mediaArgs||{};u.insert(e,r,s);var o=e.caption||S.caption,a=e.element;typeof o=="function"?o=o.call(a||{},e):o=o||a&&a.title,o&&N.$caption.append(o),O("insert"),t&&t(),g.positionHero(e),g.position()};u.load?u.load(e,function(){n.cancelLoadMsg(),e.errorMsg&&(i="error",u=g.media[i],e.media.update(i)),M(function(){a(e,i)}),O("load")}):(n.cancelLoadMsg(),M(function(){a(e,i)}),O("load"))},reload:function(e){var t=this;t.items=t.prepareItems(e),t.prepareStage(),t.loadItem(t.items[0])},prepareLoadMsg:function(){var e=this;e.loadTimer=setTimeout(function(){e.showLoadMsg()},P.preloadDelay)},cancelLoadMsg:function(){var e=this;e.hideLoadMsg(),clearTimeout(e.loadTimer)},showLoadMsg:function(){T=!0,N.$loading.show(),N.$fuzzbox.addClass("fzz-loading"),O("showLoadMsg")},hideLoadMsg:function(){T=!1,N.$loading.hide(),N.$fuzzbox.removeClass("fzz-loading"),O("hideLoadMsg")},disableLink:function(e){var t=e.attr("href");e.addClass("disabled").removeAttr("href").attr("data-href",t)},enableLink:function(e){var t=e.attr("data-href")||e[0].href;e.removeClass("disabled").attr("href",t)},goTo:function(e){var t=this,n=t.items,r=n.length-1,i=t.index;if(T||n.length<2)return;var s;if("previous"==e)s=i>0?i-1:0,S.cycle&&(s=i===0?r:i-1);else if("next"==e)s=i<r?i+1:r,S.cycle&&(s=i===r?0:i+1);else{if(!(e>0)){u("No destination");return}e-=1,s=e<=r?e:r}t.index=s,t.setNextPreviousBtns(),t.loadItem(n[t.index])},next:function(){var e=this;if(!S.cycle&&e.index>=e.items.length-1)return;this.goTo("next")},previous:function(){var e=this;if(!S.cycle&&e.index<=0)return;e.goTo("previous")},close:function(){var t=this;g._close(function(){e(window).scrollTop(x),b.element?b.element.focus():t.trigger&&t.trigger.focus(),O("close"),t.cleanup()})},cleanup:function(){var e=this;e.clearContentAreas(!0),e.enableLink(N.$previous),e.enableLink(N.$next),e.cancelLoadMsg(),N.$fuzzbox.removeClass("fzz-open");var t=N.$wrapper[0].style;t.top=t.left="",g.instance=y=null},clearContentAreas:function(e){var t=w&&!w.errorMsg&&"image"===w.media[0]&&"image"===b.media[0];t||N.$content.empty(),N.$caption.empty(),g.resetImage(),g.resetIframe(),N.$content.find(".fzz-hero").css("margin-top",""),e&&(N.$inner.empty(),N.$outer.css("top",""),g.resetImage(!0))}};var y,b,w,E,S,x,T,N=g.dom={},C=function(e){var t=this;return t.update=function(e){if(typeof e!="string")return e;var n=e.indexOf("/");t[0]=e,t[1]=null,n!==-1&&(t[0]=e.substring(0,n),t[1]=e.substring(n+1))},t.toString=function(){return t[0]+(t[1]?"/"+t[1]:"")},t.update(e)},k=function(e){var t=e.toLowerCase(),n=t.indexOf("#"),r=null;n!==-1&&(t=t.substring(0,n)),n=t.indexOf("?"),n!==-1&&(t=t.substring(0,n));var i,s=/\.([a-z0-9]+)$/.exec(t.replace(/\/+$/,"").toLowerCase());if(!s)return r;i=s[1];if(s=/^(jpe?g|png|gif|tiff?|webp)$/.exec(i))r="image/"+s[1];else if(/^svgz?$/.test(i))r="image/svg";else if(/^(webm|ogv|ogg|ogv|mp4|m4v|3gp)?$/.test(i)){var o="mp4";/^(ogv|ogg|ogm)$/.test(i)?o="ogg":"webm"===i&&(o="webm"),r="video/"+o}else(s=/^(mp3)?$/.exec(i))?r="audio/"+s[1]:/^html?$/.test(i)&&(r="html");return r},L=function(e){if(!e)return null;var t={},n="data-fzz-";return o(e.attributes,function(e,r){var i=r.name,s=i.indexOf(n);if(0===s){i=i.substring(n.length);var o=i.split("-"),u=o.shift();if(!t[u]&&!o.length)t[u]=r.value;else if(o.length){var a=u+"Args";t[a]=t[a]||{},t[a][o[0]]=r.value}}}),t},A=function(e){var t=[];return t.push("fzz-media-"+e[0]),t.push("fzz-media-"+(e+"").replace(/\//,"-")),t},O=function(e,t){var n="on"+f(e),t=t||{};t.type=e,i.trigger("fzz_"+e,t),y&&y[n]&&y[n].call(y,t)},M=function(e){var t="transitionFadeSpeed",n=t in S?S[t]:0,r=N.$content;n&&!E?(T=!0,c(r,0,n,function(){e(),p(function(){c(r,1,n,function(){T=!1})},13)})):e()},_=function(e){if(!e)return null;var t=g.getVideo();return!!t.canPlayType&&!!t.canPlayType(e).replace(/no/,"")},D={video:{mp4:'video/mp4; codecs="avc1.42E01E, mp4a.40.2"',webm:'video/webm; codecs="vp8, vorbis"',ogg:'video/ogg; codecs="theora, vorbis"'},audio:{}};s(g,{Media:C,guessMediaType:k,formats:D,testVideoFormat:_}),s(g,{DEBUG:!1,opened:!1,instance:null,init:function(){if(g.initialized)return;var t=e('<div id="fuzzbox" role="dialog"><div id="fzz-overlay"></div><div id="fzz-outer"><div id="fzz-wrapper" tabindex="0"><div id="fzz-inner"></div><div id="fzz-loading"></div><a id="fzz-close" href="modal:close"><span></span></a></div></div></div>');N.$fuzzbox=t,N.$overlay=e("#fzz-overlay",t),N.$loading=e("#fzz-loading",t),N.$outer=e("#fzz-outer",t),N.$wrapper=e("#fzz-wrapper",t),N.$inner=e("#fzz-inner",t),N.$closeBtn=e("#fzz-close",t),N.$loading.hide();var n=N.$wrapper;n.click(function(t){var n=e(t.target).closest("a"),r=n[0],i=null,s="modal:",o;if(r&&r.href&&r.href.indexOf(s)==0){i=r.href.substring(s.length);var u;(u=i.indexOf("("))!==-1?(o=i.substring(u).replace(/[\(\)]/g,""),i=i.substring(0,u)):/^\d$/.test(i)&&(o=i,i="goto")}if(!i)return;if(n.hasClass("disabled"))return!1;switch(i){case"close":g.close();break;case"previous":g.previous();break;case"next":g.next();break;case"goto":g.goTo(o||1)}return!1});var s,o=function(e,t){var n=e.pageX,o=e.pageY,a=t.width(),f=t.offset(),l=f.left,c=f.top,h=parseInt(t.css("left"),10)||0,p=parseInt(t.css("top"),10)||0,d=n-l,v=o-c,m=r.width();s={el:{T:c,R:l+a,L:l,sX:h,sY:p,bT:-(c-p),bL:-(l-h),bR:-(l-h)+(m-a)},m:{sX:n,sY:o,bT:v,bR:m-(a-d),bL:d}},i.mousemove(u)},u=function(e){var t=e.pageX,r=e.pageY,i=s.m,o=s.el,u=n[0],a=u.style,f,l;r<i.bT?l=o.bT:l=o.sY+(r-i.sY),t<i.bL?f=o.bL:t>i.bR?f=o.bR:f=o.sX+(t-i.sX),a.top=l+"px",a.left=f+"px"};n.on("mousedown.fuzzbox",function(t){var r=e(t.target);if(r.hasClass("fzz-handle"))return o(t,n),i.one("mouseup blur",function(){i.unbind("mousemove",u)}),!1}),e([N.$overlay[0],N.$outer[0]]).click(function(e){e.target===this&&S.closeOnClickOutside&&g.close()}),i.on("keyup.fuzzbox",function(e){var t=e.keyCode||e.which;t===27&&g.opened&&S.closeOnPressEscape&&g.close()}),i.on("keydown.fuzzbox",function(e){var t=e.keyCode||e.which;g.opened&&(37===t?g.previous():39===t&&g.next())}),r.on("resize.fuzzbox",function(e){if(!y)return;g.position(),g.positionHero(),g.setHeight()}),N.$fuzzbox.hide(),e("body").append(N.$fuzzbox),O("init"),g.initialized=!0},_open:function(){N.$fuzzbox.show(),g.position(),g.opened=!0},_close:function(e){var t=N.$fuzzbox;c(t,0,P.fadeSpeed,function(){t.hide().css("opacity",""),e&&e()}),g.opened=!1},open:function(e){return!(new g(e)).open()},close:function(){y&&y.close()},previous:function(){y&&y.previous()},next:function(){y&&y.next()},goTo:function(e){y&&y.goTo(e)},position:function(){var e=N.$outer[0],t=e.offsetHeight,n=r.height(),i=r.scrollTop(),s=0,o=S.vAlign;"middle"===o?n>t&&(s=(n-t)/2):"top"!==o&&+o&&(s=o),s+=i,e.style.top=s+"px"},positionHero:function(e){var t=N.$content.find(".fzz-hero");if(!S.exactFit&&t.length){var n=t[0],r=N.$content[0].offsetHeight,i=n.offsetHeight;e&&e.image&&(i=e.image.height),diff=r-i,diff>0&&(n.style.marginTop=diff/2+"px")}},setAriaLabel:function(t,n){var r=t&&e("#"+t,n||document);r&&r.length?N.$fuzzbox.attr("aria-labelledby",t):N.$fuzzbox.removeAttr("aria-labelledby")},setAriaDescription:function(t,n){var r=t&&e("#"+t,n||document);r&&r.length?N.$fuzzbox.attr("aria-describedby",t):N.$fuzzbox.removeAttr("aria-describedby")},loadUrl:function(t,n,r){var i={url:t,success:function(e){n.html=e,r(n)},error:function(e,t){n.errorMsg=t,r(n)}};n.data&&(i.data=n.data),n.postData&&(i.data=n.postData,i.type="POST"),e.ajax(i)},loadImage:function(e,t,n){var r=new Image;r.onload=function(){t.image=r,n(t)},r.onabort=r.onerror=function(r){r=r||window.event,t.errorMsg=r.type+' loading image: "'+e+'"',n(t)},r.src=e},getIframe:function(t){var n=N.iframe;return n||(n=N.iframe=d("iframe")),e(n).attr({"class":"fzz-hero",frameborder:0,width:"100%",height:"100%"}),n},resetIframe:function(){var e=N.iframe;e&&(e.src="data:text/html,0")},getVideo:function(){var e=N.video;return e||(e=N.video=d("video"),e.className="fzz-hero"),e},getAudio:function(){var e=N.audio;return e||(e=N.audio=d("audio"),e.className="fzz-hero"),e},getImage:function(){var e=N.image;return e||(e=N.image=d("img"),e.className="fzz-hero"),e},resetImage:function(e){var t=N.image;t&&(e?(delete N.image,N.image=g.getImage()):t.style.marginTop="")},setDims:function(){g.setWidth(),g.setHeight()},setWidth:function(e){var t={"max-width":y.dims.width||e||""};if(t["max-width"]&&/\d+(px)?$/.test(t["max-width"]+"")){var n=N.$inner,r=n.outerWidth(!0)-n.width();t["max-width"]=parseInt(t["max-width"],10)+r}N.$wrapper.css(t)},setHeight:function(e){var t={height:y.dims.height||e||""};N.$content.css(t)},markdown:function(t){return e.trim((" "+t+" ").replace(/([^_\w])_([^_]+)_([^_\w])/g,function(e,t,n,r){return t+"<i>"+n+"</i>"+r}).replace(/([^\*\w])\*([^\*]+)\*([^\*\w])/g,function(e,t,n,r){return t+"<b>"+n+"</b>"+r}))},template:{basic:e('<div id="fzz-handle" class="fzz-handle"></div><div id="fzz-content"></div><div id="fzz-caption"></div><a id="fzz-previous" href="modal:previous"><span></span></a><a id="fzz-next" href="modal:next"><span></span></a>')},media:{error:{insert:function(e,t,n){t.innerHTML='<p class="fzz-hero">'+e.errorMsg+"</p>"}},html:{load:function(e,t,n){!a(e.html)&&e.url?g.loadUrl(e.url,e,function(e){t(e.errorMsg)}):t()},insert:function(t,n,r){if(r.target){var i=d("div");i.innerHTML=t.html,t.html=e(i).find(r.target).html()}e(n).append(t.html)}},image:{load:function(e,t,n){g.loadImage(e.url,e,function(e){t(e.errorMsg)})},insert:function(e,t,n){var i=g.getImage();i.src=e.image.src;var s=i.naturalWidth||e.image.width,o=i.naturalHeight||e.image.height,u=r.width(),a=S.fittingBreakpoint,f=a&&u<a;if(u>s||f)g.setHeight(o),S.exactFit&&g.setWidth(s);i.parentNode||t.appendChild(i)}},iframe:{insert:function(t,n,r){var i=g.getIframe(),s="width"in r?r.width:"100%",o="height"in r?r.height:"100%",u={src:t.url||r.url,width:s,height:o};delete r.url,delete r.src,e.extend(u,r),e(i).attr(u),n.appendChild(i)}},"video/youtube":{insert:function(t,n,r){var i=g.getIframe(),s="width"in r?r.width:"100%",o="height"in r?r.height:"100%";e(i).attr({src:"http://www.youtube.com/embed/"+r.ytid,width:s,height:o}),n.appendChild(i)}}}});var P=g.settings={};s(P,{text:{close:"Close",next:"Next",previous:"Previous"},preloadDelay:80,fadeSpeed:150}),e.fn.fuzzbox=function(t){var n=this,t=t||{},r="html"in t,i=t.url,u=!0===t.group&&!r&&!i,a=[];return u&&n.each(function(){var e={};e.url=this.href,e.element=this,a.push(e)}),n.click(function(){var n=new e.fuzzbox,f=0,l=this,c=s({},t);return c.element=this,!r&&!i&&(u?(o(a,function(e,t){l===t.element&&(f=e)}),c.index=f):t.items?a=t.items:a=[{url:this.getAttribute("href")?this.href:null,element:this}]),a.length&&(c.items=a),!n.open(c)}),n}})(jQuery);